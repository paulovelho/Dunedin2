import{a as g,b as d,c as re}from"./chunk-LOL3TW3O.js";import{a as ie}from"./chunk-K3XDBYVD.js";import{$a as Z,B as a,Ba as H,C as l,D as p,Da as J,E as y,Ea as Q,F as h,Fa as X,G as u,Ha as F,Ia as E,O as U,P as v,R,S as N,T as D,U as P,Xa as Y,Y as O,_ as x,_a as j,ab as $,bb as V,cb as ee,db as te,eb as k,i as G,ja as B,l as f,m as L,n as C,o as w,qa as K,ra as I,s as c,t as m,wa as b,xa as W,y as _,ya as z,z as n}from"./chunk-N3QAHXRB.js";function ue(r,i){if(r&1){let o=y();a(0,"app-table",5),h("rowClick",function(t){C(o);let s=u();return w(s.userClick(t))}),l()}if(r&2){let o=u();n("items",o.items)("keys",o.keys)("titles",o.titles)}}var T=(()=>{let i=class i{constructor(e,t,s){this.transloco=e,this.nav=t,this.userService=s,this.loading=!1,this.users=[],this.items=[],this.keys=[],this.titles={}}ngOnInit(){this.loading=!0,this.setKeys(),this.userService.GetUsers().subscribe(e=>{this.users=e,this.loading=!1,this.manageUsers()})}setKeys(){this.keys=["id_display","name","email","roleName","last_login"],this.keys.forEach(e=>this.titles[e]=this.transloco.translate("users.title-"+e))}manageUsers(){this.users.forEach(e=>{this.items.push(Object.assign({},e,{id_display:"#"+e.id}))})}userClick(e){let t=e?.id;t&&this.nav.userView(t)}addUser(){this.nav.userNew()}};i.\u0275fac=function(t){return new(t||i)(m(F),m(I),m(d))},i.\u0275cmp=f({type:i,selectors:[["app-users-list"]],standalone:!0,features:[U([d,g]),v],decls:6,vars:6,consts:[["icon","fa-users",3,"title","loading","showClose"],["actions",""],[1,"transition",3,"click"],[1,"fa","fa-plus-circle"],[3,"items","keys","titles","rowClick",4,"ngIf"],[3,"rowClick","items","keys","titles"]],template:function(t,s){t&1&&(a(0,"app-window",0),N(1,"transloco"),a(2,"span",1)(3,"a",2),h("click",function(){return s.addUser()}),p(4,"i",3),l()(),_(5,ue,1,3,"app-table",4),l()),t&2&&(n("title",D(1,4,"users.list-title"))("loading",s.loading)("showClose",!1),c(5),n("ngIf",!s.loading))},dependencies:[k,x,j,te,E],styles:[`td.column-id_display{font-weight:700}
`],encapsulation:2});let r=i;return r})();var M=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=f({type:i,selectors:[["app-users"]],standalone:!0,features:[v],decls:1,vars:0,template:function(t,s){t&1&&p(0,"app-users-list")},dependencies:[T],encapsulation:2});let r=i;return r})();var se={ADMIN:"Admin",MANAGER:"Manager",KEEPER:"Keeper"};var he=r=>({name:r});function ve(r,i){if(r&1){let o=y();a(0,"div",3)(1,"div",14),p(2,"app-input",15),l(),a(3,"div",16)(4,"app-button",17),h("action",function(){C(o);let t=u(2);return w(t.genPassword())}),l()()()}r&2&&(c(2),n("required",!0))}function ge(r,i){if(r&1){let o=y();a(0,"form",2)(1,"div",3)(2,"div",4),p(3,"app-input",5),l(),a(4,"div",4),p(5,"app-input",6),l()(),_(6,ve,5,1,"div",7),a(7,"div",3)(8,"div",8),p(9,"app-input",9),l(),a(10,"div",8),p(11,"app-select",10),l(),a(12,"div",8),p(13,"app-select",11),l()(),a(14,"div",3)(15,"div",12)(16,"app-button",13),h("action",function(){C(o);let t=u();return w(t.save())}),l()()()()}if(r&2){let o=u();n("formGroup",o.form)("ngClass",o.fs.formClass(o.form)),c(3),n("required",!0),c(2),n("type",o.isNew?"text":"disabled")("required",!0),c(),n("ngIf",o.isNew),c(5),n("options",o.roles)("required",!0),c(2),n("options",o.languages)("required",!0)}}var S=(()=>{let i=class i{constructor(e,t,s,A,ne,ae){this.fs=e,this.route=t,this.transloco=s,this.nav=A,this.service=ne,this.toaster=ae,this.id=null,this.loading=!1,this.isNew=!1,this.title="",this.name="...",this.languages=[],this.roles=[]}ngOnInit(){this.id=this.route.snapshot.paramMap.get("id"),this.loadLanguages(),this.loadRoles(),this.loadUser(),this.buildForm()}loadLanguages(){this.languages=V(ie)}loadRoles(){this.roles=V(se)}buildForm(){let e={name:["",b.required],email:["",b.required],phone_number:[""],language:[""],role:["",b.required]};this.isNew&&Object.assign(e,{password:["",b.required]}),this.form=this.fs.BuildFromGroup(e)}setUser(e){Object.keys(this.form?.controls).forEach(s=>this.form?.controls[s].setValue(e[s]))}getControl(e){return this.form.controls[e]}loadUser(){if(!this.id)return this.newUser();this.loading=!0,this.title="users.edit",this.isNew=!1,this.service.GetUserById(this.id).subscribe({next:e=>{this.loading=!1,this.user=e,this.name=this.user?.name,this.setUser(e)}})}newUser(){this.title="users.new",this.isNew=!0,this.user=this.service.newUser()}save(){let e=this.fs.validate(this.form);if(!e.valid){this.toaster.error(this.transloco.translate("validation-error"));return}this.service.Save(Object.assign(this.user,e.data)).then(t=>{if(t){let s=this.transloco.translate("save-success",{object:"User"});this.toaster.success(s),this.nav.userList()}else{let s=this.transloco.translate("save-error",{object:"User"});this.toaster.error(s)}}).catch(t=>this.toaster.error(t.message))}genPassword(){let e=Math.random().toString(36).slice(-10);this.form?.controls.password.setValue(e)}};i.\u0275fac=function(t){return new(t||i)(m(re),m(B),m(F),m(I),m(d),m(Y))},i.\u0275cmp=f({type:i,selectors:[["app-users-form"]],standalone:!0,features:[U([d,g]),v],decls:3,vars:9,consts:[["icon","fa-user",3,"showClose","title","loading"],[3,"formGroup","ngClass",4,"ngIf"],[3,"formGroup","ngClass"],[1,"row"],[1,"col-sm-6"],["id","name","formControlName","name","label","users.title-name",3,"required"],["id","email","formControlName","email","label","users.title-email",3,"type","required"],["class","row",4,"ngIf"],[1,"col-sm-4"],["id","phone_number","formControlName","phone_number","label","users.title-phone"],["id","role","formControlName","role","label","users.title-roleName",3,"options","required"],["id","language","formControlName","language","label","users.title-language",3,"options","required"],[1,"col-sm-5","offset-sm-7"],["type","save",3,"action"],[1,"col-sm-7"],["id","password","type","disabled","formControlName","password","label","users.title-password",3,"required"],[1,"col-sm-5"],["extraClass","label-margin","type","primary","caption","users.btn-gen-password",3,"action"]],template:function(t,s){t&1&&(a(0,"app-window",0),N(1,"transloco"),_(2,ge,17,10,"form",1),l()),t&2&&(n("showClose",!1)("title",P(1,4,s.title,R(7,he,s.name)))("loading",s.loading),c(2),n("ngIf",s.user))},dependencies:[k,O,x,H,W,z,X,J,Q,j,Z,$,ee,E]});let r=i;return r})();var oe=[{path:"",component:M},{path:"view/:id",component:S,data:{breadcrumb:"view"}},{path:"new",component:S,data:{breadcrumb:"new"}}];var Ce=[M,T,S],Ze=[g,d],$e=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=L({type:i}),i.\u0275inj=G({imports:[Ce,K.forChild(oe)]});let r=i;return r})();export{$e as UsersModule,Ce as components,Ze as userProviders};
